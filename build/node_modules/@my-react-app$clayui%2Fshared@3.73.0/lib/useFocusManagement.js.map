{"version":3,"sources":["useFocusManagement.js"],"names":["Object","defineProperty","exports","value","FOCUSABLE_ELEMENTS","isFocusable","useFocusManagement","_react","_interopRequireDefault","require","obj","__esModule","default","HostComponent","_ref","_tagName","contentEditable","disabled","href","offsetParent","rel","tabIndex","tagName","type","toLowerCase","minTabIndex","collectDocumentFocusableElements","Array","from","document","querySelectorAll","join","filter","element","isFiberHostComponentFocusable","fiber","tag","memoizedProps","stateNode","collectFocusableElements","node","focusableElements","push","child","sibling","getFiber","scope","current","internalKey","keys","find","key","indexOf","getFocusableElementsInScope","fiberNode","nextFocusInDocRef","useRef","prevFocusInDocRef","moveFocusInScope","backwards","arguments","length","undefined","fiberFocusElements","activeElement","docFocusElements","docPosition","reactFiberPosition","nextFocusInDoc","prevFocusInDoc","nextFocusInFiber","prevFocusInFiber","nextActive","focus","focusNext","focusPrevious"],"mappings":"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","file":"useFocusManagement.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FOCUSABLE_ELEMENTS = void 0;\nexports.isFocusable = isFocusable;\nexports.useFocusManagement = useFocusManagement;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * SPDX-FileCopyrightText: Â© 2019 Liferay, Inc. <https://liferay.com>\n * SPDX-License-Identifier: BSD-3-Clause\n */\n// https://github.com/facebook/react/blob/master/packages/shared/ReactWorkTags.js#L39\nvar HostComponent = 5;\n\nfunction isFocusable(_ref) {\n  var _tagName;\n\n  var contentEditable = _ref.contentEditable,\n      disabled = _ref.disabled,\n      href = _ref.href,\n      offsetParent = _ref.offsetParent,\n      rel = _ref.rel,\n      tabIndex = _ref.tabIndex,\n      tagName = _ref.tagName,\n      type = _ref.type;\n  // Normalize casing\n  tagName = (_tagName = tagName) === null || _tagName === void 0 ? void 0 : _tagName.toLowerCase(); // Hack to check if element is visible\n\n  if (!offsetParent) {\n    return false;\n  }\n\n  if (disabled) {\n    return false;\n  }\n\n  var minTabIndex = 0;\n\n  if (tabIndex != null && tabIndex < minTabIndex) {\n    return false;\n  }\n\n  if (tabIndex != null && tabIndex >= minTabIndex || contentEditable === true || contentEditable === 'true') {\n    return true;\n  }\n\n  if (tagName === 'a' || tagName === 'area') {\n    return !!href && rel !== 'ignore';\n  }\n\n  if (tagName === 'input') {\n    return type !== 'file' && type !== 'hidden';\n  }\n\n  return tagName === 'button' || tagName === 'embed' || tagName === 'iframe' || tagName === 'object' || tagName === 'select' || tagName === 'textarea';\n}\n\nvar FOCUSABLE_ELEMENTS = ['a[href]', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])', 'area[href]', 'button:not([disabled]):not([aria-hidden])', 'embed', 'iframe', 'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden])', 'object', 'select:not([disabled]):not([aria-hidden])', 'textarea:not([disabled]):not([aria-hidden])'];\nexports.FOCUSABLE_ELEMENTS = FOCUSABLE_ELEMENTS;\n\nfunction collectDocumentFocusableElements() {\n  return Array.from(document.querySelectorAll(FOCUSABLE_ELEMENTS.join(','))).filter(function (element) {\n    return isFocusable(element);\n  });\n} // https://github.com/facebook/react/pull/15849#diff-39a673d38713257d5fe7d90aac2acb5aR107\n\n\nvar isFiberHostComponentFocusable = function isFiberHostComponentFocusable(fiber) {\n  if (fiber.tag !== HostComponent) {\n    return false;\n  }\n\n  var memoizedProps = fiber.memoizedProps,\n      stateNode = fiber.stateNode,\n      type = fiber.type; // The element may be having an update in progress.\n\n  if (memoizedProps === null) {\n    return false;\n  }\n\n  return isFocusable({\n    contentEditable: memoizedProps.contentEditable,\n    disabled: memoizedProps.disabled,\n    href: memoizedProps.href,\n    offsetParent: stateNode.offsetParent,\n    rel: memoizedProps.rel,\n    tabIndex: memoizedProps.tabIndex,\n    tagName: type,\n    type: memoizedProps.type\n  });\n};\n\nvar collectFocusableElements = function collectFocusableElements(node, focusableElements) {\n  if (isFiberHostComponentFocusable(node)) {\n    focusableElements.push(node.stateNode);\n  }\n\n  var child = node.child;\n\n  if (child !== null) {\n    collectFocusableElements(child, focusableElements);\n  }\n\n  var sibling = node.sibling;\n\n  if (sibling) {\n    collectFocusableElements(sibling, focusableElements);\n  }\n};\n\nvar getFiber = function getFiber(scope) {\n  if (!scope.current) {\n    return null;\n  }\n\n  var internalKey = Object.keys(scope.current).find(function (key) {\n    return key.indexOf('__reactInternalInstance') === 0 || key.indexOf('__reactFiber') === 0;\n  });\n\n  if (internalKey) {\n    return scope.current[internalKey];\n  }\n\n  return null;\n};\n\nvar getFocusableElementsInScope = function getFocusableElementsInScope(fiberNode) {\n  var focusableElements = [];\n  var child = fiberNode.child;\n\n  if (child !== null) {\n    collectFocusableElements(child, focusableElements);\n  }\n\n  return focusableElements;\n};\n\nfunction useFocusManagement(scope) {\n  var nextFocusInDocRef = _react.default.useRef(null);\n\n  var prevFocusInDocRef = _react.default.useRef(null);\n\n  var moveFocusInScope = function moveFocusInScope(scope) {\n    var backwards = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var fiberFocusElements = getFocusableElementsInScope(scope);\n\n    if (fiberFocusElements.length === 0) {\n      return null;\n    }\n\n    var activeElement = document.activeElement;\n\n    if (!activeElement) {\n      return;\n    }\n\n    var docFocusElements = collectDocumentFocusableElements();\n    var docPosition = docFocusElements.indexOf(activeElement);\n    var reactFiberPosition = fiberFocusElements.indexOf(activeElement); // Ignore when the active element is not in the scope.\n\n    if (reactFiberPosition < 0) {\n      return null;\n    }\n\n    var nextFocusInDoc = docFocusElements[docPosition + 1];\n    var prevFocusInDoc = docFocusElements[docPosition - 1];\n    var nextFocusInFiber = fiberFocusElements[reactFiberPosition + 1];\n    var prevFocusInFiber = fiberFocusElements[reactFiberPosition - 1]; // If these two nodes are not equal, that means React is likely using\n    // a portal to render the node in a different part of the DOM. When\n    // this happens, we want to track where the next node is in case we\n    // reach the end of the list of focusable nodes.\n\n    if (nextFocusInFiber !== nextFocusInDoc) {\n      nextFocusInDocRef.current = nextFocusInDoc;\n    } // Same as above, except we track the previous node for tabbing backwards.\n\n\n    if (prevFocusInFiber !== prevFocusInDoc) {\n      prevFocusInDocRef.current = prevFocusInDoc;\n    }\n\n    var nextActive = backwards ? prevFocusInFiber : nextFocusInFiber; // We track the previous and next elements in the document flow due to React portals.\n    //\n    // Consider the following structure of dom elements and where a React Tree is:\n    //\n    // <HtmlFocusElement1>\n    // <ReactTree>\n    // <HtmlFocusElement2>\n    //\n    // When our focus gets to the end of the React Tree, we want to focus HtmlFocusElement2\n    // When we are at the beginning of the React Tree and want to go backwards with\n    // SHIFT + TAB, we want to focus HtmlFocusElement1. This allows the React Tree to\n    // render nodes whereever it would like in the document.\n    //\n    // If there is no `nextActive`, that means we are either at the beginning or end of the\n    // list of focusable elements in the React Tree. So we go back to the flow of the\n    // document instead of the flow of the React Tree.\n\n    if (!nextActive) {\n      nextActive = backwards ? prevFocusInDocRef.current : nextFocusInDocRef.current;\n    }\n\n    if (nextActive) {\n      nextActive.focus();\n\n      if (nextActive === prevFocusInDocRef.current || nextActive === nextFocusInDocRef.current) {\n        nextFocusInDocRef.current = null;\n        prevFocusInDocRef.current = null;\n      }\n\n      return nextActive;\n    }\n\n    return null;\n  };\n\n  return {\n    focusNext: function focusNext() {\n      return moveFocusInScope(getFiber(scope));\n    },\n    focusPrevious: function focusPrevious() {\n      return moveFocusInScope(getFiber(scope), true);\n    }\n  };\n}"]}